<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://illixr.github.io/ILLIXR/docs/monado_illixr_runtime_overview/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Monado Integration Overview - ILLIXR Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Monado Integration Overview";
    var mkdocs_page_input_path = "monado_illixr_runtime_overview.md";
    var mkdocs_page_url = "/ILLIXR/docs/monado_illixr_runtime_overview/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ILLIXR Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">ILLIXR</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../getting_started/">Getting Started</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../default_plugins/">Default Plugins</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../writing_your_plugin/">Writing Your Plugin</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../modifying_a_plugin/">Modifying A Plugin</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../building_illixr/">Building ILLIXR</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../debugging_illixr/">ILLIXR Debugging Tips</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Monado Integration Overview</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1-app-launches-and-brings-up-monado">1. App launches and brings up Monado</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-monado-probes-hmd-devices-and-illixr-initializes">2.  Monado probes HMD devices and Illixr Initializes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-illixr-runtime-launch">3. Illixr Runtime Launch</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#4-the-translation-plugin">4. The translation plugin</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../monado_integration_dataflow/">Monado Integration Dataflow</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../visualizer_logger/">Visualizer & Logger</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="" href="https://illixr.github.io/ILLIXR/api/html/annotated.html">API documentation</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ILLIXR Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Monado Integration Overview</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="monado-integration-overview">Monado Integration Overview</h1>
<p>ILLIXR's plugins provide XR services, and the runtime ties them together. However, we don't want to
force developers to write <em>their wohle application</em> specifically for ILLIXR. As such, we want to
implement a common interface XR runtimes, such as <a href="https://www.khronos.org/openxr/">OpenXR</a>, so one application can work on
several runtimes (including ours). In order to support OpenXR, we modified <a href="https://monado.dev/">Monado</a>, an existing,
open-source implementation.</p>
<ul>
<li>
<p>When running ILLIXR without Monado, the Illixr runtime is the entry-point. Phonebook and
  switchboard are initialized and plugins are loaded, among which is the gldemo app.</p>
</li>
<li>
<p>When running from Monado, however, as mandated by OpenXR specifications, the application is the
  entry point. As a result, the Illixr runtime system is loaded at a later point as a shared
  library. This article documents the changes to the Illixr runtime when an OpenXR application is
  used.</p>
</li>
</ul>
<h2 id="1-app-launches-and-brings-up-monado">1. App launches and brings up Monado</h2>
<p>As specified by OpenXR, the OpenXR application initializes the OpenXR runtime by reading a
configuration JSON file pointed to by an environment variable and loads the OpenXR runtime, which is
Monado in this case, as a shared library into its address space. Consult the OpenXR specifications
and the OpenXR-SDK from Khronous Group for more details.</p>
<h2 id="2-monado-probes-hmd-devices-and-illixr-initializes">2.  Monado probes HMD devices and Illixr Initializes</h2>
<p>During initialization, Monado asks all drivers to probe for and initialize HMDs and controllers,
internally known as <code>xdev</code>s.  We have an Illixr driver, which will always respond to Monado with one
discovered HMD that will be used to capture OpenXR queries and events from Monado's state
tracker. The Illixr driver obtains the path to the Illixr runtime so file and a list of plugins from
environment variables.</p>
<p>After probing is finished, the application will start to create an OpenXR session. At some point in
this process, the application will send its rendering context to the runtime, which we capture and
send to the Illixr driver. At this moment, all necessary data is ready and Illixr will be launched.</p>
<h2 id="3-illixr-runtime-launch">3. Illixr Runtime Launch</h2>
<p>When used with Monado, the Illixr runtime is compiled into a shared library instead of an
executable. The library exports its two major functionalities: initializing switchboard and
phonebook, and load plugins.</p>
<p>The drivers starts to load the runtime by loading the shared library into the current (the app's)
address space and calls the switchboard and phonebook initialization. Then, it calls the plugin
loading for each Illixr plugin (except gldemo, which is replaced by the OpenXR app). Finally, it
calls a special plugin loading which takes a function address instead of a file path to load a
translation plugin into Illixr as the application. The translation plugin will be in the next
section. Each plugin should either not block or start its own thread, so the driver will be able to
reacquire control and return to Monado and the app shortly.</p>
<h2 id="4-the-translation-plugin">4. The translation plugin</h2>
<p>When the app and all Illixr plugins are up and running, the translation plugin handles the
connection between Monado and Illixr. It might be confusing to see that this plugin is part of the
Illixr driver which is part of Monado while at the same time also part of Illixr as a plugin. But
Monado and Illixr are running in different threads in the same address space. The translation plugin
is the intersection of these two parallel systems serving as a bridge between the two.</p>
<p>The translation plugin handles two types of events at the moment: pose requests and frame
submissions. From the view of Monado, it is the destination of all requests: from the application,
to Monado's state trackers, to the xdev interface who is responsible for servicing the request. From
the view of Illixr, it behaves the same as the gldemo app: reading pose and submitting frames.</p>
<p>For implementation details regarding the representation of poses and frames in Monado and in Illixr,
please see Monado Integration Dataflow.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../monado_integration_dataflow/" class="btn btn-neutral float-right" title="Monado Integration Dataflow">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../debugging_illixr/" class="btn btn-neutral" title="ILLIXR Debugging Tips"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../debugging_illixr/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../monado_integration_dataflow/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
