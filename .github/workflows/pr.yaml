name: illixr-tests-pr

on:
  pull_request:
    branches: [ master ]

env:
  ghcr_token: ${{ secrets.GHCR_TOKEN }}

jobs:
  illixr-tests-pr-ubuntu18:
    env:
      distro_ver: 18.04
    runs-on: ubuntu-18.04
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: recursive

      - name: Extract Branch Name
        id: extract_branch
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        shell: bash

      - name: Run CI (fetch-build-run)
        uses: ILLIXR/github-actions-workflows@v1
        with:
          distro_ver : ${{ env.distro_ver }}
          branch     : ${{ steps.extract_branch.outputs.branch }}
  illixr-tests-pr-ubuntu20:
    env:
      distro_ver: 20.04
    runs-on: ubuntu-20.04
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: recursive

      - name: Extract Branch Name
        id: extract_branch
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        shell: bash

      - name: Run CI (fetch-build-run)
        uses: ILLIXR/github-actions-workflows@v1
        with:
          distro_ver : ${{ env.distro_ver }}
          branch     : ${{ steps.extract_branch.outputs.branch }}
